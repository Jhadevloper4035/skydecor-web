<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Skydecor | Product page</title>
  <meta name="description" content />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.png" />

  <!-- CSS ============================================ -->

  <!-- Font Awesome CDN -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <!-- Icon Font CSS -->
  <link rel="stylesheet" href="/css/icons.min.css" />
  <!-- Plugins CSS -->
  <link rel="stylesheet" href="/css/plugins.css" />
  <!-- Main Style CSS -->
  <link rel="stylesheet" href="/css/style.css" />

 
</head>

<body>
  <%- include("../partials/header") %>

   


       <div class="container-fluid">
        <div class="breadcrumb-section">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">products</li>
                </ol>
            </nav>
        </div>
    </div>






    <div class="shop-area pt-95 pb-100">
      <div class="container">
        <div class="row flex-row-reverse" >


          <div class="col-lg-9" id="shop-area"> 

            <%- include('../partials/product-card', { products: products }) %>

          </div>






          <div class="col-lg-3">
            <div class="sidebar-style mr-30">
              <div class="sidebar-widget">
                <h4 class="pro-sidebar-title">Search</h4>
                <div class="pro-sidebar-search mb-50 mt-25">
                  <form class="pro-sidebar-search-form" action="#">
                    <input type="text" placeholder="Search here..." />
                    <button type="submit">
                      <i class="pe-7s-search"></i>
                    </button>
                  </form>
                </div>
              </div>

              <form id="filterForm" action="/products/" method="get">
                <!-- Product Types -->
                <div class="sidebar-widget mt-50">
                  <h4 class="pro-sidebar-title">Product Types</h4>
                  <div class="sidebar-widget-list mt-20">
                    <ul>
                      <% productTypes.forEach(function(pt) { %>
                        <li>
                          <div class="sidebar-widget-list-left">
                            <input type="checkbox" value="<%= pt %>" name="productType[]" <%=filters.productType &&
                              filters.productType.includes(pt) ? 'checked' : '' %>
                            />
                            <a href="javascript:void(0)">
                              <%= pt %>
                            </a>
                            <span class="checkmark"></span>
                          </div>
                        </li>
                        <% }) %>
                    </ul>
                  </div>
                </div>

                <!-- Product Categories -->
                <div class="sidebar-widget mt-50">
                  <h4 class="pro-sidebar-title">Product Categories</h4>
                  <div class="sidebar-widget-list mt-20">
                    <ul>
                      <% categories.forEach(function(cat) { %>
                        <li>
                          <div class="sidebar-widget-list-left">
                            <input type="checkbox" value="<%= cat %>" name="category[]" <%=filters.category &&
                              filters.category.includes(cat) ? 'checked' : '' %> />
                            <a href="javascript:void(0)">
                              <%= cat %>
                            </a>
                            <span class="checkmark"></span>
                          </div>
                        </li>
                        <% }) %>
                    </ul>
                  </div>
                </div>

                <!-- Product SubCategories -->
                <div class="sidebar-widget mt-50">
                  <h4 class="pro-sidebar-title">Product SubCategory</h4>
                  <div class="sidebar-widget-list mt-20">
                    <ul>
                      <% subCategories.forEach(function(sc) { %>
                        <li>
                          <div class="sidebar-widget-list-left">
                            <input type="checkbox" value="<%= sc %>" name="subCategory[]" <%=filters.subCategory &&
                              filters.subCategory.includes(sc) ? 'checked' : '' %>
                            />
                            <a href="javascript:void(0)">
                              <%= sc %>
                            </a>
                            <span class="checkmark"></span>
                          </div>
                        </li>
                        <% }) %>
                    </ul>
                  </div>
                </div>


                <!-- Product Sizes -->
                <div class="sidebar-widget mt-50">
                  <h4 class="pro-sidebar-title">Sizes</h4>
                  <div class="sidebar-widget-list mt-20">
                    <ul>
                      <% sizes.forEach(function(s) { %>
                        <li>
                          <div class="sidebar-widget-list-left">
                            <input type="checkbox" value="<%= s %>" name="size[]" <%=filters.size &&
                              filters.size.includes(s) ? 'checked' : '' %> />
                            <a href="javascript:void(0)">
                              <%= s %>
                            </a>
                            <span class="checkmark"></span>
                          </div>
                        </li>
                        <% }) %>
                    </ul>
                  </div>
                </div>

                <!-- Product Thickness -->
                <div class="sidebar-widget mt-50">
                  <h4 class="pro-sidebar-title">Thickness</h4>
                  <div class="sidebar-widget-list mt-20">
                    <ul>
                      <% thicknesss.forEach(function(t) { %>
                        <li>
                          <div class="sidebar-widget-list-left">
                            <input type="checkbox" value="<%= t %>" name="thickness[]" <%=filters.thickness &&
                              filters.thickness.includes(t) ? 'checked' : '' %> />
                            <a href="javascript:void(0)">
                              <%= t %>
                            </a>
                            <span class="checkmark"></span>
                          </div>
                        </li>
                        <% }) %>
                    </ul>
                  </div>
                </div>
              </form>
              
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include("../partials/footer") %> 
    <%- include("../partials/product-modal") %>

        <script src="/js/vendor/modernizr-3.11.7.min.js"></script>
        <script src="/js/vendor/jquery-v3.6.0.min.js"></script>
        <script src="/js/vendor/jquery-migrate-v3.3.2.min.js"></script>
        <script src="/js/vendor/popper.min.js"></script>
        <script src="/js/vendor/bootstrap.min.js"></script>
        <script src="/js/plugins.js"></script>
        <!-- Ajax Mail -->
        <script src="/js/ajax-mail.js"></script>
        <!-- Main JS -->
        <script src="/js/main.js"></script>

        <script>


          document.addEventListener("DOMContentLoaded", function () {
            const filterForm = document.querySelector("#filterForm");
            const shopArea = document.querySelector("#shop-area");

            if (!filterForm || !shopArea) return;

            // Render skeleton cards while loading
            function showSkeleton(count = 8) {
              shopArea.innerHTML = Array.from({ length: count })
                .map(
                  () => `
                        <div class="product-card col-lg-3 col-md-4 col-sm-6 skeleton">
                            <div class="image"></div>
                            <div class="text-line short"></div>
                            <div class="text-line"></div>
                            <div class="text-line short"></div>
                        </div>
                    `
                )
                .join("");
            }

            // Fetch products via AJAX
            function fetchProducts(url = null) {
              const checkboxes = filterForm.querySelectorAll("input[type=checkbox]:checked");
              const params = [];

              checkboxes.forEach((cb) => {
                const key = cb.name.replace("[]", ""); // remove []
                const value = encodeURIComponent(cb.value);
                params.push(`${key}=${value}`);
              });

              // ✅ Get productType from form action (/products/:productType)
              const baseUrl = filterForm.getAttribute("action");

            
              // Build final fetch URL
              const fetchUrl = url || `${baseUrl}?${params.join("&")}`;

              // Show skeleton while loading
              showSkeleton();

              fetch(fetchUrl, { headers: { "X-Requested-With": "XMLHttpRequest" } })
                .then((res) => res.text())
                .then((html) => {
                  shopArea.innerHTML = html; // replace skeleton with products
                  // Optional: scroll to top smoothly
                  window.scrollTo({ top: 0, behavior: "smooth" });
                })
                .catch((err) => {
                  console.error("❌ AJAX error:", err);
                  shopArea.innerHTML = `<p class="error">Failed to load products. Please try again.</p>`;
                });
            }

            // Auto-submit when any checkbox is changed
            filterForm.querySelectorAll("input[type=checkbox]").forEach((cb) => {
              cb.addEventListener("change", () => fetchProducts());
            });

            // Pagination click handling
            document.body.addEventListener("click", function (e) {
              const link = e.target.closest(".pagination a");
              if (link) {
                e.preventDefault();
                fetchProducts(link.href); // ✅ link already has productType + query
              }
            });
          });


        </script>



</body>

</html>